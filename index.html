<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>2048 Triage Advisor</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <style>
    #grid-container {
      display: grid;
      grid-template-columns: repeat(4, 80px);
      grid-gap: 10px;
      margin-top: 1rem;
    }
    .tile {
      transition: all 0.15s ease-in-out;
    }

    .tile {
      width: 80px;
      height: 80px;
      background-color: #333;
      color: white;
      font-size: 1.5rem;
      font-weight: bold;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 6px;
    }

    body {
      font-family: 'Inter', sans-serif;
      background-color: #0f0f0f;
      color: #f2f2f2;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      min-height: 100vh;
      margin: 0;
      padding: 2rem;
    }
    h1 {
      font-size: 2rem;
      margin-bottom: 1rem;
    }
    textarea {
      width: 300px;
      height: 180px;
      padding: 1rem;
      background: #1a1a1a;
      border: 1px solid #333;
      border-radius: 8px;
      color: #f2f2f2;
      resize: none;
      font-family: monospace;
      font-size: 1rem;
      margin-bottom: 1rem;
    }
    button {
      padding: 0.75rem 1.5rem;
      background-color: #06c;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
    }
    button:hover {
      background-color: #058;
    }
    #output {
      margin-top: 1.5rem;
      white-space: pre-wrap;
      font-size: 1rem;
      background: #1c1c1c;
      padding: 1rem;
      border-radius: 8px;
      width: 320px;
    }
  </style>
</head>
<body>
  <h1>üß† 2048 AI Advisor</h1>
<div id="game">
  <h2>2048</h2>
  <div id="grid-container"></div>
  <div id="game-over" style="display: none;">Game Over</div>
</div>
<script>
let board = Array(4).fill().map(() => Array(4).fill(0));

function getEmptyTiles() {
  const empty = [];
  for (let r = 0; r < 4; r++) {
    for (let c = 0; c < 4; c++) {
      if (board[r][c] === 0) empty.push([r, c]);
    }
  }
  return empty;
}

function addRandomTile() {
  const empty = getEmptyTiles();
  if (empty.length === 0) return;
  const [r, c] = empty[Math.floor(Math.random() * empty.length)];
  board[r][c] = Math.random() < 0.9 ? 2 : 4;
}
function rotateMatrixLeft(matrix) {
  return matrix[0].map((_, i) => matrix.map(row => row[3 - i]));
}

function rotateMatrixRight(matrix) {
  return matrix[0].map((_, i) => matrix.map(row => row[i])).reverse();
}

function rotateMatrix180(matrix) {
  return rotateMatrixLeft(rotateMatrixLeft(matrix));
}


function drawBoard() {
  const container = document.getElementById("grid-container");
  container.innerHTML = "";
  for (let r = 0; r < 4; r++) {
    for (let c = 0; c < 4; c++) {
      const tile = document.createElement("div");
      tile.className = "tile";
      tile.textContent = board[r][c] === 0 ? "" : board[r][c];
      container.appendChild(tile);
    }
  }
}

function compress(row) {
  const newRow = row.filter(x => x !== 0);
  while (newRow.length < 4) newRow.push(0);
  return newRow;
}

function merge(row) {
  for (let i = 0; i < 3; i++) {
    if (row[i] !== 0 && row[i] === row[i + 1]) {
      row[i] *= 2;
      row[i + 1] = 0;
    }
  }
  return compress(row);
}

function rotateLeft(matrix) {
  return matrix[0].map((_, i) => matrix.map(row => row[3 - i]));
}

function move(direction) {
  let rotated;
  if (direction === "up") rotated = rotateMatrixLeft(board);
  else if (direction === "right") rotated = rotateMatrix180(board);
  else if (direction === "down") rotated = rotateMatrixRight(board);
  else rotated = board.map(row => [...row]); // left (no rotation)

  let moved = rotated.map(row => merge(compress(row)));

  if (JSON.stringify(moved) === JSON.stringify(rotated)) return; // No move

  if (direction === "up") board = rotateMatrixRight(moved);
  else if (direction === "right") board = rotateMatrix180(moved);
  else if (direction === "down") board = rotateMatrixLeft(moved);
  else board = moved;

  addRandomTile();
  drawBoard();
  giveAdvice();


  if (getEmptyTiles().length === 0 && !canMerge()) {
    document.getElementById("game-over").style.display = "block";
  }
}

function canMerge() {
  for (let r = 0; r < 4; r++) {
    for (let c = 0; c < 4; c++) {
      if (r < 3 && board[r][c] === board[r + 1][c]) return true;
      if (c < 3 && board[r][c] === board[r][c + 1]) return true;
    }
  }
  return false;
}

document.addEventListener("keydown", (e) => {
  switch (e.key) {
    case "ArrowUp": move("up"); break;
    case "ArrowRight": move("right"); break;
    case "ArrowDown": move("down"); break;
    case "ArrowLeft": move("left"); break;
  }
});

function giveAdvice() {
  const row0 = board[0];
  const col0 = board.map(row => row[0]);
  const flat = board.flat();
  const max = Math.max(...flat);
  const mergeablePairs = [];

  for (let i = 0; i < 4; i++) {
    for (let j = 0; j < 3; j++) {
      if (board[i][j] !== 0 && board[i][j] === board[i][j + 1]) mergeablePairs.push([[i, j], [i, j + 1]]);
      if (board[j][i] !== 0 && board[j][i] === board[j + 1][i]) mergeablePairs.push([[j, i], [j + 1, i]]);
    }
  }

  function isDescending(arr) {
    return arr.every((val, i, a) => i === 0 || a[i - 1] >= val);
  }

  const inv = {
    'King in corner': board[0][0] === max,
    'Row 0 full': row0.every(v => v !== 0),
    'Column 0 full': col0.every(v => v !== 0),
    'Row 0 descending': isDescending(row0),
    'Column 0 descending': isDescending(col0),
    'Row 1 descending': isDescending(board[1]),
    'Board full & no merges': flat.every(x => x !== 0) && mergeablePairs.length === 0,
  };

  let advice = "All invariants green. Continue normal play: LEFT until no change, then UP.";
  if (!inv['King in corner']) advice = "Move the king (largest tile) to top-left using UP and LEFT.";
  else if (!inv['Row 0 full']) advice = "Row 0 not full. Try UP (if col 3 filled), else Row-0 Pump (Down ‚Üí Up).";
  else if (!inv['Column 0 full']) advice = "Column 0 has a gap. Use Column-0 Pump (Down ‚Üí optional Left ‚Üí Up).";
  else if (!inv['Row 0 descending']) advice = "Row 0 out of order. Use Down ‚Üí Left ‚Üí Up.";
  else if (!inv['Column 0 descending']) advice = "Column 0 out of order. Use Down ‚Üí Left ‚Üí Up.";
  else if (!inv['Row 1 descending']) advice = "Row 1 out of order. If stuck, Down ‚Üí Left ‚Üí Up.";
  else if (inv['Board full & no merges']) advice = "Board is full with no merges. Use Up ‚Üí Left to force a vertical merge.";

  const result = Object.entries(inv).map(([k, v]) => `${v ? '‚úÖ' : '‚ùå'} ${k}`).join("\n");
  let out = document.getElementById("output");
  if (!out) {
    out = document.createElement("div");
    out.id = "output";
    document.body.appendChild(out);
  }
  out.textContent = `${advice}\n\n${result}`;
}


addRandomTile();
drawBoard();
giveAdvice();

</script>


 
</body>
</html>
